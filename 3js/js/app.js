const screenBlock=document.querySelector(".screen__canvas"),screen=document.querySelector("#screen-canvas"),controlBtns=document.querySelectorAll(".controlBtn"),routeHud=document.querySelector("#screen__route");function init(){let e=0,t=0,o=0,n=0,r=0,i=0,a=0,d=.1,c=new THREE.Scene,s=new THREE.WebGLRenderer({canvas:screen});s.setClearColor(1114130,1),s.shadowMapEnabled=!0,s.setSize(parseInt(getComputedStyle(screenBlock).width),parseInt(getComputedStyle(screenBlock).height));let l=new THREE.PerspectiveCamera(65,parseInt(getComputedStyle(screenBlock).width)/parseInt(getComputedStyle(screenBlock).height),.1,1e3);l.position.z=5;new THREE.Vector3(0,0,0);let p=new THREE.FogExp2(16734611,1e-4);c.fog=p;let w=new THREE.TextureLoader,E=new THREE.BoxGeometry,h=new THREE.MeshLambertMaterial({map:w.load("img/testWall.jpg")}),m=new THREE.MeshBasicMaterial({map:w.load("img/retroSun.jpg")}),y=new THREE.MeshBasicMaterial({map:w.load("img/lamp.jpg")}),u=new THREE.Mesh(new THREE.PlaneGeometry(20,20,0,0),h);u.rotation.x=-Math.PI/2,u.receiveShadow=!0,u.position.y=-.5,u.castShadow=!0,c.add(u);let M=new THREE.Mesh(new THREE.PlaneGeometry(100,100,1,1),m);M.position.set(0,20,-200),M.castShadow=!0,c.add(M);let g=new THREE.PointLight(12895428,10);g.position.set(0,2,2.5),g.castShadow=!0,c.add(g);let H=new THREE.Mesh(E,y);H.position.set(0,2,2.5),c.add(H);let R=new THREE.GridHelper(100,20,15597823,15597823);R.position.set(0,-.5,0),c.add(R);let S={},T=0;for(let e=0;e<map.length;e++)for(let t=0;t<map[e].length;t++)if(map[e][t]){let o=new THREE.Mesh(E,h);o.position.set(e,0,t),o.castShadow=!0,o.receiveShadow=!0,c.add(o),S[T]={x:e,y:0,z:t},T++}document.addEventListener("keydown",(function(c){"KeyW"==c.code||"ArrowUp"==c.code?t=d:"KeyS"==c.code||"ArrowDown"==c.code?e=d:"KeyD"==c.code||"ArrowRight"==c.code?n=d:"KeyA"==c.code||"ArrowLeft"==c.code?o=d:"KeyA"==c.code||"ArrowLeft"==c.code?r=d:"KeyQ"==c.code?a=.1:"KeyE"==c.code&&(i=.1)})),document.addEventListener("keyup",(function(r){"KeyW"==r.code||"ArrowUp"==r.code?t=0:"KeyS"==r.code||"ArrowDown"==r.code?e=0:"KeyD"==r.code||"ArrowRight"==r.code?n=0:"KeyA"==r.code||"ArrowLeft"==r.code?o=0:"KeyQ"==r.code?a=0:"KeyE"==r.code&&(i=0)})),screen.addEventListener("mousemove",e=>{(180/Math.PI*l.rotation.y>=360||180/Math.PI*l.rotation.y<=-360)&&(l.rotation.y=0);const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=(e.movementY||e.mozMovementY||e.webkitMovementY,t*Math.PI/180);l.rotation.y-=o},!0);let v=new THREE.Mesh(E,h);v.position.set(-2,2,-2),v.castShadow=!0,v.receiveShadow=!0,c.add(v);let x=.1,A=function(){requestAnimationFrame(A),deg=180/Math.PI*l.rotation.y,v.rotation.x+=.01,v.rotation.y+=.01;let r=(n-o)*Math.cos(l.rotation.y)-(t-e)*Math.sin(l.rotation.y),d=-(t-e)*Math.cos(l.rotation.y)-(n-o)*Math.sin(l.rotation.y),p=i-a;l.position.x+=r,l.position.z+=d,l.rotation.y-=p,g.position.x>=5&&(x=-.01),g.position.x<=-5&&(x=.01),g.position.x+=x,H.position.x+=x,printRouteHud(l.position.x,l.position.z),s.render(c,l)};A()}function printRouteHud(e,t){routeHud.innerText=`x:${e}|z:${t}`}screen.width=parseInt(getComputedStyle(screen).width),screen.height=parseInt(getComputedStyle(screen).height),map=[[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1]],init();
const screenBlock=document.querySelector(".screen__canvas"),screen=document.querySelector("#screen-canvas"),controlBtns=document.querySelectorAll(".controlBtn"),routeHud=document.querySelector("#screen__route"),hideMouse=document.querySelector(".hideMouse");function init(){let e=0,t=0,o=0,n=0,r=0,i=0,d=0,a=.05,s=.09,c=!1,l={x:parseInt(getComputedStyle(screenBlock).width)/2,y:parseInt(getComputedStyle(screenBlock).height)/2},u=!1,h={},p=0,m=.1,E=new THREE.Scene,w=new THREE.WebGLRenderer({canvas:screen});w.setClearColor(1114130,1),w.shadowMapEnabled=!0,w.setSize(parseInt(getComputedStyle(screenBlock).width),parseInt(getComputedStyle(screenBlock).height));let y=new THREE.PerspectiveCamera(65,parseInt(getComputedStyle(screenBlock).width)/parseInt(getComputedStyle(screenBlock).height),.1,1e3);y.position.set(-2,0,5);let g=new THREE.FogExp2(16734611,1e-4);E.fog=g;let M=new THREE.TextureLoader,S=new THREE.BoxGeometry,R=new THREE.MeshLambertMaterial({map:M.load("img/testWall.jpg")}),H=new THREE.MeshBasicMaterial({map:M.load("img/retroSun.jpg")}),v=new THREE.MeshBasicMaterial({map:M.load("img/lamp.jpg")}),T=new THREE.Mesh(new THREE.PlaneGeometry(20,20,0,0),R);T.rotation.x=-Math.PI/2,T.receiveShadow=!0,T.position.y=-.5,T.castShadow=!0,E.add(T);let x=new THREE.Mesh(new THREE.PlaneGeometry(100,100,1,1),H);x.position.set(0,20,-200),x.castShadow=!0,E.add(x);let f=new THREE.PointLight(12895428,10);f.position.set(0,2,2.5),f.castShadow=!0,E.add(f);let k=new THREE.Mesh(S,v);k.position.set(0,2,2.5),E.add(k);let B=new THREE.Mesh(S,R);B.position.set(-2,2,-2),B.castShadow=!0,B.receiveShadow=!0,E.add(B);let L=new THREE.GridHelper(100,50,15597823,15597823);L.position.set(0,-.5,0),E.add(L);for(let e=0;e<map.length;e++)for(let t=0;t<map[e].length;t++)if(map[e][t]){let o=new THREE.Mesh(S,R);o.position.set(e,0,t),o.castShadow=!0,o.receiveShadow=!0,E.add(o),h[p]={x:e,y:0,z:t},p++}console.log(h);for(var A=h.length-1;A>=0;A--)h[A];controlBtns.forEach(r=>{r.addEventListener("mousedown",()=>{let c=r.getAttribute("data");"right"===c?n=a:"left"===c?o=a:"up"===c?t=a:"down"===c?e=a:"turnLeft"===c?i=s:"turnRight"===c&&(d=s)})}),controlBtns.forEach(a=>{a.addEventListener("mouseup",()=>{e=t=o=n=r=i=d=0})}),document.addEventListener("keydown",(function(r){"KeyW"==r.code||"ArrowUp"==r.code?t=a:"KeyS"==r.code||"ArrowDown"==r.code?e=a:"KeyD"==r.code||"ArrowRight"==r.code?n=a:"KeyA"==r.code||"ArrowLeft"==r.code?o=a:"KeyQ"==r.code?i=s:"KeyE"==r.code&&(d=s)})),document.addEventListener("keyup",(function(r){"KeyW"==r.code||"ArrowUp"==r.code?t=0:"KeyS"==r.code||"ArrowDown"==r.code?e=0:"KeyD"==r.code||"ArrowRight"==r.code?n=0:"KeyA"==r.code||"ArrowLeft"==r.code?o=0:"KeyQ"==r.code?i=0:"KeyE"==r.code&&(d=0)})),document.addEventListener("mousemove",e=>{if(c){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=(e.movementY||e.mozMovementY||e.webkitMovementY,t*Math.PI/180);y.rotation.y-=o}},!0),document.addEventListener("pointerlockchange",e=>{c=!c}),hideMouse.onclick=function(){c||hideMouse.requestPointerLock()};let K=function(){u=y.position.x>5,requestAnimationFrame(K),deg=180/Math.PI*y.rotation.y,(deg>=360||deg<=-360)&&(y.rotation.y=0);let r=(n-o)*Math.cos(y.rotation.y)-(t-e)*Math.sin(y.rotation.y),a=-(t-e)*Math.cos(y.rotation.y)-(n-o)*Math.sin(y.rotation.y),s=i-d;u&&(r=-r,a=-a),y.position.x+=r,y.position.z+=a,y.rotation.y+=s,f.position.x>=5&&(m=-.01),f.position.x<=-5&&(m=.01),f.position.x+=m,k.position.x+=m,B.rotation.x+=.01,B.rotation.y+=.01,printRouteHud(y.position.x,y.position.z,deg,c,l,r,a),w.render(E,y)};K()}function printRouteHud(e,t,o,n,r,i,d){e=Math.round(e),t=Math.round(t),o=Math.round(o),routeHud.innerText=`x:${e}|mouse_lock:${n}\n\tz:${t}|rotY:${o}\n\tdx:${i};dz:${d}\n\tscreen_center: ${r.x} x ${r.y}\n\t`}screen.width=parseInt(getComputedStyle(screen).width),screen.height=parseInt(getComputedStyle(screen).height),map=[[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1],[0,0,0,0,0,0],[1,0,0,0,0,1]],init();